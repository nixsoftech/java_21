def dump_peak_margin_grid(peak_margin_win):
    """
    Reads all rows from Peak Margin grid and returns them as list of lists.
    Each row will include cell text values.
    Also logs control type + name for debugging to ensure correct column mapping.
    """
    all_rows = []
    try:
        grid = peak_margin_win.child_window(control_type="Table")
        rows = grid.children(control_type="DataItem")
        logger.info(f"Found {len(rows)} rows in Peak Margin grid.")

        for idx, row in enumerate(rows):
            cells = row.children()
            row_values = []
            debug_info = []
            for cell_idx, cell in enumerate(cells):
                try:
                    val = cell.legacy_properties().get("Value") or cell.window_text() or "(null)"
                except Exception:
                    val = "(error)"
                row_values.append(val)
                debug_info.append(f"[{cell_idx}:{cell.friendly_class_name()}:'{val}']")
            logger.info(f"Row {idx}: {' | '.join(debug_info)}")
            all_rows.append(row_values)

    except Exception as e:
        logger.error(f"Failed to dump Peak Margin grid: {e}")

    return all_rows
