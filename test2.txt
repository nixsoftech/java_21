def handle_peak_margin(app):
    logger.info("Navigating to RMS Configuration -> Peak Margin via menu_select...")
    main_window = app.window(title_re="NCDEX RISK MANAGEMENT SYSTEM.*")
    main_window.menu_select("RMS Configuration->Peak Margin")
    logger.info("Successfully opened Peak Margin section.")

    logger.info("Waiting for Peak Margin grid or controls to load...")
    try:
        # Wait until the Peak Margin DataGrid or Pane appears inside the main window
        grid = main_window.child_window(control_type="DataGrid")
        grid.wait("exists enabled visible", timeout=30)
        logger.info("Peak Margin grid is now visible.")
    except TimeoutError:
        logger.error("Peak Margin grid not found within 30 seconds.")
        # Dump controls for debugging
        main_window.print_control_identifiers()
        raise

    # Now click the Add button
    try:
        add_btn = main_window.child_window(title="Add", control_type="Button")
        add_btn.wait("enabled", timeout=10).click_input()
        logger.info("Clicked 'Add' button in Peak Margin.")
    except Exception as e:
        logger.error(f"Failed to click 'Add' button: {e}")
        # Dump available controls so we can refine search if needed
        main_window.print_control_identifiers()
        raise
