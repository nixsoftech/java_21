def handle_post_login_popups(app, timeout=15):
    logger.info("Checking for post-login popups...")
    start_time = time.time()

    while time.time() - start_time < timeout:
        try:
            popup = app.window(title_re=".*")
            if popup.exists(timeout=1) and popup.is_visible():
                popup_text = popup.window_text().strip()
                logger.info(f"Post-login popup detected: '{popup_text}'")

                # Handle "Do you want to close the RMS ?" popup -> Click NO (AutomationId=7)
                if "do you want to close the rms" in popup_text.lower():
                    try:
                        no_btn = popup.child_window(auto_id="7", control_type="Button")
                        no_btn.wait("enabled", timeout=5).click_input()
                        logger.info("Clicked NO (AutomationId=7) on 'Do you want to close the RMS ?' popup.")
                        time.sleep(1)
                        continue
                    except Exception as e:
                        logger.error(f"Failed to click NO button: {e}")

                # Handle "BMS OpmsEngine Got abandoned at Primary" popup -> Click OK (AutomationId=2)
                elif "bms opmsengine got abandoned" in popup_text.lower():
                    try:
                        ok_btn = popup.child_window(auto_id="2", control_type="Button")
                        ok_btn.wait("enabled", timeout=5).click_input()
                        logger.info("Clicked OK (AutomationId=2) on 'BMS OpmsEngine Got abandoned at Primary' popup.")
                        time.sleep(1)
                        continue
                    except Exception as e:
                        logger.error(f"Failed to click OK button: {e}")

                # If popup is unknown, just log and do not click anything
                else:
                    logger.warning(f"Unknown popup detected, skipping click: '{popup_text}'")
                    time.sleep(1)
            else:
                time.sleep(0.5)

        except Exception as e:
            logger.debug(f"No popup detected yet: {e}")
            time.sleep(0.5)
