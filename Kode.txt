def handle_popup(app, expected_substring=None, auto_id_to_click="2", timeout=10):
    """Handle popup window by AutomationId (OK button)."""
    start = time.time()
    while time.time() - start < timeout:
        try:
            popup = app.window(title_re=".*Risk Management System.*")
            if popup.exists():
                popup.wait("visible", timeout=3)
                popup_texts = popup.descendants(control_type="Text")
                for t in popup_texts:
                    txt = t.window_text().strip()
                    if not expected_substring or expected_substring.lower() in txt.lower():
                        logger.info(f"Popup detected: '{txt}'")
                        try:
                            ok_btn = popup.child_window(auto_id=auto_id_to_click, control_type="Button")
                            ok_btn.click_input()
                            logger.info(f"Clicked popup button with AutomationId={auto_id_to_click}")
                            return True
                        except Exception as e:
                            logger.error(f"Failed to click popup button: {e}")
                            return False
        except ElementNotFoundError:
            pass
        time.sleep(1)
    logger.warning("No popup appeared within timeout.")
    return False
