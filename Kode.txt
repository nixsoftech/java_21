def handle_post_login_popups(app, timeout=15):
    logger.info("Checking for post-login popups...")
    start_time = time.time()
    while time.time() - start_time < timeout:
        try:
            popup = app.window(title_re=".*")
            if popup.exists(timeout=1) and popup.is_visible():
                popup_text = popup.window_text().strip()
                logger.info(f"Post-login popup detected: '{popup_text}'")

                # --- Special Case: Do you want to close the RMS? -> Click NO ---
                if "do you want to close the rms" in popup_text.lower():
                    try:
                        no_btn = popup.child_window(title="No", control_type="Button")
                        if no_btn.exists():
                            no_btn.click_input()
                            logger.info("Clicked 'No' on 'Do you want to close the RMS?' popup.")
                            time.sleep(1)
                            continue
                    except Exception as e:
                        logger.error(f"Failed to click 'No' button: {e}")

                # --- Special Case: BMS OpmsEngine Got abandoned at Primary -> Click OK ---
                if "bms opmsengine got abandoned" in popup_text.lower():
                    try:
                        ok_btn = popup.child_window(title="OK", control_type="Button")
                        if ok_btn.exists():
                            ok_btn.click_input()
                            logger.info("Clicked 'OK' on 'BMS OpmsEngine Got abandoned at Primary' popup.")
                            time.sleep(1)
                            continue
                    except Exception as e:
                        logger.error(f"Failed to click 'OK' button: {e}")

                # --- Generic fallback for other popups ---
                for btn_text in ["OK", "Yes", "Retry", "Close"]:
                    try:
                        btn = popup.child_window(title=btn_text, control_type="Button")
                        if btn.exists():
                            btn.click_input()
                            logger.info(f"Clicked '{btn_text}' on generic popup.")
                            time.sleep(1)
                            break
                    except Exception:
                        pass
            else:
                time.sleep(0.5)
        except Exception:
            time.sleep(0.5)
